(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{190:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return b})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var r=n(1),a=n(9),i=(n(0),n(233)),l={},b={id:"1072/Week13",title:"Week13",description:"# Week 13(2019/05/16) - \u5099\u4efd\u8207\u81ea\u52d5\u5316",source:"@site/docs/1072/Week13.md",permalink:"/docs/1072/Week13",editUrl:"https://github.com/NCNU-OpenSource/NCNU-OpenSource.github.io/edit/src/docs/1072/Week13.md",sidebar:"someSidebar",previous:{title:"Week12",permalink:"/docs/1072/Week12"},next:{title:"Week14",permalink:"/docs/1072/Week14"}},c=[{value:"ZFS\uff08\u4fd7\u7a31 Zetta File System\uff09",id:"zfs\uff08\u4fd7\u7a31-zetta-file-system\uff09",children:[]},{value:"100MB.bin",id:"100mbbin",children:[]},{value:"RAID",id:"raid",children:[{value:"Raid 0\uff08\u4ee5\u5169\u9846\u786c\u789f\u70ba\u4f8b\uff0c\u9808\u70ba\u96d9\u6578)",id:"raid-0\uff08\u4ee5\u5169\u9846\u786c\u789f\u70ba\u4f8b\uff0c\u9808\u70ba\u96d9\u6578",children:[]},{value:"Raid 1: Mirror (\u4ee5\u5169\u500b\u786c\u789f\u70ba\u4f8b)",id:"raid-1-mirror-\u4ee5\u5169\u500b\u786c\u789f\u70ba\u4f8b",children:[]},{value:"Raid 5(\u81f3\u5c11\u4e09\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1aN-1)",id:"raid-5\u81f3\u5c11\u4e09\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1an-1",children:[]},{value:"Raid 6(\u81f3\u5c11\u56db\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1aN-2)",id:"raid-6\u81f3\u5c11\u56db\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1an-2",children:[]},{value:"RAID 10(RAID 1 + RAID 0)",id:"raid-10raid-1--raid-0",children:[]}]},{value:"RAID Speed:",id:"raid-speed",children:[]},{value:"Hot backup",id:"hot-backup",children:[]},{value:"Warm(Mix) backup",id:"warmmix-backup",children:[]},{value:"Cold backup",id:"cold-backup",children:[{value:"SCP",id:"scp",children:[]},{value:"Rsync",id:"rsync",children:[]}]},{value:"\u7d44\u614b\u7ba1\u7406",id:"\u7d44\u614b\u7ba1\u7406",children:[{value:"Ansible",id:"ansible",children:[]}]}],o={rightToc:c};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},o,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"week-1320190516---\u5099\u4efd\u8207\u81ea\u52d5\u5316"},"Week 13(2019/05/16) - \u5099\u4efd\u8207\u81ea\u52d5\u5316"),Object(i.b)("p",null,"\u672c\u9031\u7c21\u5831: ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.google.com/presentation/d/1wJTCemM79a-d8FDMcgH6nDHAyifFsLjQzEL8xYDYnaw/edit?usp=sharing"}),"\u672c\u9031 Slide")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"\u5099\u4efd\u5f88\u91cd\u8981 \u66f4\u91cd\u8981\u7684\u662f\u7570\u5730\u5099\u4efd \u5929\u707d\u4eba\u798d\u96e3\u4ee5\u9810\u6e2c\uff0c\n\u4e0d\u5c0f\u5fc3\u4e00\u628a\u706b\uff0c\u53ef\u80fd\u5c31\u6c92\u4e86")),Object(i.b)("p",null,":::info\n\u5982\u679c\u5b89\u88dd\u8edf\u9ad4\u9047\u5230\u7528",Object(i.b)("inlineCode",{parentName:"p"},"curl  ... \u7136\u5f8c | sh "),"\u7b49\u7684 \u6307\u4ee4 \uff0c\n\u26a0\ufe0f\u6700\u597d\u4e0d\u8981\u76f4\u63a5Pipe\n\ud83c\udd97\u5148\u4e0b\u8f09\u4e0b\u4f86\u770b\u6c92\u6709\u6bd2\u624d\u5b89\u88dd\n:::"),Object(i.b)("h1",{id:"data-duplicator-dd"},"Data Duplicator (dd)"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"sync \u908a\u5beb\u908a\u5099\u4efd \u2192 \u901f\u5ea6\u6bd4\u8f03\u6162"),Object(i.b)("li",{parentName:"ul"},"fsync \u76f4\u63a5\u628a\u8cc7\u6599\u4e1f\u6389\u7de9\u885d\u5340\u518d\u6162\u6162\u80cc\u8ca0 \u2192 \u901f\u5ea6\u6bd4\u8f03\u5feb")),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"sudo dd if=/dev/sdb of=/home/..../backup.img\nif = \u8981\u5099\u4efd\u7684\u6771\u897f # input\nof = \u88ab\u5206\u5230\u54ea\u88cf # output\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"dd"),"+",Object(i.b)("inlineCode",{parentName:"li"},"gzip")," \u5099\u4efd\u7684\u8a71 = \u628a\u8981\u5099\u4efd\u7684\u786c\u789f\u88cf\u9762\u76840\u58d3\u7e2e\u6389\uff0c\u518d\u5099\u4efd\n+ \u597d\u8655 \uff1a\u8cc7\u6599\u6bd4\u8f03\u5c11\uff0c\u5099\u4efd\u6bd4\u8f03\u5feb"),Object(i.b)("li",{parentName:"ul"},"tar \u53ea\u662f\u6253\u5305\u6c92\u6709\u58d3\u7e2e, \u6240\u4ee5\u8981\u5927\u60b2gzip \u4f86\u4f7f\u7528\n+ tar \u5c0d\u6253\u5305\u591a\u500b\u6a94\u6848\u624d\u6703\u6bd4\u8f03\u6709\u4f5c\u7528")),Object(i.b)("h3",{id:"zfs\uff08\u4fd7\u7a31-zetta-file-system\uff09"},"ZFS\uff08\u4fd7\u7a31 Zetta File System\uff09"),Object(i.b)("p",null,":::danger\n\u4e0d\u8981\u7528\u5728\u6839\u76ee\u9304\uff01\u96d6\u7136\u53ef\u4ee5\uff0c\u4f46\u662f\u8a2d\u5b9a\u5f88\u9ebb\u7169\uff01\n\u4e00\u822c\u628a\u7528\u5230\u7684\u8cc7\u6e90\uff0c\u5982docker\u3001\u9700\u8981\u7528\u5230\u7684\u76ee\u9304\u3001db\u7b49\u76ee\u9304\u8a2d\u5230ZFS\n:::"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Zpool - \u908f\u8f2f\u786c\u789f\u7ba1\u7406\u80fd\u529b "),Object(i.b)("li",{parentName:"ul"},"\u6709snapshot \u7684\u529f\u80fd"),Object(i.b)("li",{parentName:"ul"},"\u6709Copy-on-write & \u81ea\u52d5\u4fee\u5fa9\u7684\u529f\u80fd")),Object(i.b)("p",null,Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.freebsd.org/doc/zh_TW/books/handbook/zfs-zfs.html"}),"\u6307\u4ee4\u53c3\u8003 FreeBSD")),Object(i.b)("p",null,":::info"),Object(i.b)("h4",{id:"\u6dfa\u8ac7-lz4"},"\u6dfa\u8ac7 LZ4"),Object(i.b)("p",null,"\u58d3\u7e2e\u7387\u4e0d\u662f\u6700\u597d\u7684\n\u4f46\u662f\u901f\u5ea6\u662f\u6700\u5feb\u7684\n:::"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u5efa\u7acb\u5feb\u7167 ",Object(i.b)("inlineCode",{parentName:"li"},"zfs snapshot {snapshot name exp:datapool/docs@version1}")),Object(i.b)("li",{parentName:"ul"},"\u770b\u5efa\u7acb\u7684\u5feb\u7167 ",Object(i.b)("inlineCode",{parentName:"li"},"zfs lists -t snapshot")),Object(i.b)("li",{parentName:"ul"},"\u522a\u9664\u5feb\u7167  ",Object(i.b)("inlineCode",{parentName:"li"},"zfs destroy {snapshot name}")),Object(i.b)("li",{parentName:"ul"},"\u628asnapshot\u639b\u8f09\u5230\u5176\u4ed6\u76ee\u9304",Object(i.b)("inlineCode",{parentName:"li"},"zfs clone datapool/docs@version3 datapool/docs/v3")," \u6539\u8b8aMount point \u53ea\u80fd\u5728\u5df2\u7d93\u5efa\u7acbzfs\u7cfb\u7d71\u7684\u786c\u789f\u4f7f\u7528 "),Object(i.b)("li",{parentName:"ul"},"ZFS \u8b8a\u5feb\u7684\u65b9\u6cd5\n+ ZIL \u5f88\u50cf raid \u5361\u4e0a\u9762\u7684\u8a18\u61b6\u9ad4\uff088G\uff09\n+ \u7d50\u679c\u5beb\u5165\u5c31\u6703\u8b8a\u5f88\u5feb\n+  L2ARC\n+ \u7b2c\u4e8c\u5c64\u7528\u8b80\u5f88\u5feb\u7684 SSD\uff0c\u4e0d\u7528\u8cb7\u8cb4\u8cb4 ECC Memory \u4f86 cache\uff0c\u5176\u5be6\u4e5f\u883b\u5feb\u7684")),Object(i.b)("p",null,":::danger\n1. XFS\uff1a\u6bd4\u8f03\u4e0d\u958b\u653e\uff0c\u4f46\u662f\u6548\u80fd\u4e5f\u4e0d\u932f\n2. BTRFS\uff1a\n:::"),Object(i.b)("h3",{id:"100mbbin"},"100MB.bin"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"$ wget https://speed.hetzner.de/100MB.bin")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u4e0a\u8ab2\u4ecb\u7d39\u7684\u662f FileSystem \u7684\u90e8\u5206"),Object(i.b)("li",{parentName:"ul"},"\u53ef\u4ee5\u865b\u64ec\u6210\u65b0\u7684\u786c\u789f\n",Object(i.b)("img",Object(r.a)({parentName:"li"},{src:"https://louwrentius.com/static/images/zfs-overview.png",alt:null})))),Object(i.b)("h2",{id:"raid"},"RAID"),Object(i.b)("h3",{id:"raid-0\uff08\u4ee5\u5169\u9846\u786c\u789f\u70ba\u4f8b\uff0c\u9808\u70ba\u96d9\u6578"},"Raid 0\uff08\u4ee5\u5169\u9846\u786c\u789f\u70ba\u4f8b\uff0c\u9808\u70ba\u96d9\u6578)"),Object(i.b)("p",null,"\u6a94\u6848\u76f4\u63a5\u4e00\u5206\u70ba\u4e8c\uff0c\u5206\u5225\u5b58\u5165\u786c\u789f\uff0c\u901f\u5ea6\u6700\u5feb\n\u26a0\ufe0f \u4e00\u500b\u639b\u5c31\u518d\u898b"),Object(i.b)("h3",{id:"raid-1-mirror-\u4ee5\u5169\u500b\u786c\u789f\u70ba\u4f8b"},"Raid 1: Mirror (\u4ee5\u5169\u500b\u786c\u789f\u70ba\u4f8b)"),Object(i.b)("p",null,"\u901f\u5ea6\u6162\uff0c\u9700\u8981 Mirror\n\u6a94\u6848\u96d9\u5411\u5b58\u5165(Mirror)"),Object(i.b)("h3",{id:"raid-5\u81f3\u5c11\u4e09\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1an-1"},"Raid 5(\u81f3\u5c11\u4e09\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1aN-1)"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u6703\u5c07\u6a94\u6848\u4e00\u5206\u70ba\u4e8c\u5b58\u653e\u4e26\u4e14\u984d\u5916\u5c07 Hash \u503c\u5b58\u5728\u7b2c\u4e09\u9846\u786c\u789f\uff0c\u53ea\u8981\u5176\u4e2d\u4e00\u9846\u639b\uff0c\u53ef\u4ee5\u7531\u5176\u4e2d\u5169\u9846\u6062\u5fa9"),Object(i.b)("li",{parentName:"ul"},"\u6548\u80fd\u4e0d\u4e00\u5b9a\uff0c\u6703\u8f03\u82b1\u8cbb CPU\uff0c\u9700\u8981\u6aa2\u9a57 Checksum"),Object(i.b)("li",{parentName:"ul"},"\u6548\u80fd\u4e5f\u53d6\u6c7a\u65bcRAID\u5361")),Object(i.b)("h3",{id:"raid-6\u81f3\u5c11\u56db\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1an-2"},"Raid 6(\u81f3\u5c11\u56db\u9846\u786c\u789f\uff0c\u5bb9\u91cf\uff1aN-2)"),Object(i.b)("p",null,"\u540cRAID 5\uff0c\u4f46hash\u5247\u6703\u5efa\u7acb\u5728\u5169\u9846(RAID 5 \u4e00\u9846)\u3002"),Object(i.b)("h3",{id:"raid-10raid-1--raid-0"},"RAID 10(RAID 1 + RAID 0)"),Object(i.b)("p",null,"\u5169\u9846Mirror\uff0c\u4e00\u9846\u505a\u5206\u5272\uff1f"),Object(i.b)("h2",{id:"raid-speed"},"RAID Speed:"),Object(i.b)("p",null,"0 > 5|6 > 1"),Object(i.b)("p",null,":::info\n\u53ef\u4ee5\u5229\u7528\u4e0a\u8ff0\u7d44\u5408\u4f86\u9054\u5230\u76ee\u6a19\u6548\u80fd\n:::"),Object(i.b)("h1",{id:"dr-disaster-recovery"},"DR Disaster Recovery"),Object(i.b)("h2",{id:"hot-backup"},"Hot backup"),Object(i.b)("p",null,"\u5099\u63f4\u7ad9\u786c\u9ad4\u53ca\u8edf\u9ad4\u8207\u7dda\u4e0a\u7ad9\u5dee\u4e0d\u591a\uff0c\u53ef\u4ee5\u7acb\u5373\u8f49\u63db"),Object(i.b)("h2",{id:"warmmix-backup"},"Warm(Mix) backup"),Object(i.b)("p",null,"\u4ecb\u65bc\u524d\u5f8c\u5169\u8005\u4e4b\u9593\uff0c\u53ef\u4ee5\u5728\u5c11\u6578\u64cd\u4f5c\u4e4b\u4e0b\u4e0a\u7dda\u5099\u63f4"),Object(i.b)("h2",{id:"cold-backup"},"Cold backup"),Object(i.b)("p",null,"\u5099\u63f4\u7ad9\u53ea\u8cc7\u6599\uff0c\u8edf\u9ad4\u53ca\u786c\u9ad4\u8f03\u4e0d\u5b8c\u6574\uff0c\u9700\u8981\u555f\u7528\u7684\u8a71\u8981\u82b1\u66f4\u591a\u6642\u9593"),Object(i.b)("h3",{id:"scp"},"SCP"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"scp -P {Port number} {\u8981\u4e0a\u50b3\u7684\u6a94\u6848} {\u9060\u7aef\u4e3b\u6a5f\u7684\u76ee\u9304}"),"\n",Object(i.b)("inlineCode",{parentName:"p"},"-r")," recursive \u7528\u65bc\u76ee\u9304\n",Object(i.b)("inlineCode",{parentName:"p"},"-l")," limit \u9650\u5236\u901f\u5ea6\n",Object(i.b)("inlineCode",{parentName:"p"},"-C")," compress \u58d3\u7e2e"),Object(i.b)("h3",{id:"rsync"},"Rsync"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u53ef\u4ee5\u586b\u904e\u6c92\u6709\u8b8a\u52d5\u7684\u6a94\u6848\uff08\u5dee\u7570\u5099\u4efd\uff1f\uff09"),Object(i.b)("li",{parentName:"ul"},"\u53ef\u4ee5\u672c\u5730\u5099\u4efd \u6216 \u9060\u7aef\u5099\u4efd"),Object(i.b)("li",{parentName:"ul"},"\u9060\u7aef\u5099\u4efd\u7684\u65b9\u5f0f\n+ ",Object(i.b)("inlineCode",{parentName:"li"},"rsync -avzh -e 'ssh -p {port number}' {\u8981\u5099\u4efd\u7684\u76ee\u9304} {\u9060\u7aef\u4e3b\u6a5f\u7684\u76ee\u9304}")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--delete")," \u4e00\u908a\u5099\u4efd\u4e00\u908a\u522a\u9664\u539f\u672c\u7684\u6a94\u6848"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--delete-after")," \u5099\u4efd\u5b8c\u6210\u5f8c\u518d\u522a\u9664")),Object(i.b)("h2",{id:"\u7d44\u614b\u7ba1\u7406"},"\u7d44\u614b\u7ba1\u7406"),Object(i.b)("h3",{id:"ansible"},"Ansible"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u91cd\u8907\u7684\u6d41\u7a0b\u81ea\u52d5\u5316",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"e.g. install vim etc."))),Object(i.b)("li",{parentName:"ul"},"Infrastructure as a Code",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"\u786c\u8edf\u9ad4\u8a2d\u5b9a\u8b8a\u6210code"),Object(i.b)("li",{parentName:"ul"},"git")))))}p.isMDXComponent=!0},233:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return O}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=a.a.createContext({}),p=function(e){var t=a.a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):b({},t,{},e)),n},d=function(e){var t=p(e.components);return a.a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},s=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,o=c(e,["components","mdxType","originalType","parentName"]),d=p(n),s=r,O=d["".concat(l,".").concat(s)]||d[s]||u[s]||i;return n?a.a.createElement(O,b({ref:t},o,{components:n})):a.a.createElement(O,b({ref:t},o))}));function O(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=s;var b={};for(var c in t)hasOwnProperty.call(t,c)&&(b[c]=t[c]);b.originalType=e,b.mdxType="string"==typeof e?e:r,l[1]=b;for(var o=2;o<i;o++)l[o]=n[o];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,n)}s.displayName="MDXCreateElement"}}]);